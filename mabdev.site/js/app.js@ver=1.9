var requestAnimFrame = (function () {
  return (
    window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.oRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function (callback) {
      window.setTimeout(callback, 1000 / 60);
    }
  );
})();
if(window.innerWidth<600){
  console.log(123);
  document.querySelector('body').style.height = window.innerHeight + 'px';
}
const prizeText1 = ` <p class="prize__text" >
Not bad, for the first try!
</p>
<p class="prize__text prize__text_better">
But you can do better...
</p>
`;
const prizeText2 = ` <p class="prize__text">
The luck is on your side,
</p>
<p class="prize__text prize__text_better">
so try again!
</p>
`;
const prizeText3 = ` <p class="prize__text" style="margin-top:-10px">
Congratulations!
</p>
<p class="prize__text prize__text_better">
You won â‚¬20 free cash!
</p>
<a href="https://greenspin.bet" class="prize__link" id="pop-up" target="_blank">
<span style='cursor:pointer; z-index: 1000'>
    GRAB THE PRIZE
</span>
</a>`;
const wrapper = document.querySelector(".wrapper");
const offerText = document.querySelector(".offer__text");
const prizeText = document.querySelector(".prize");
const loader = document.querySelector("#loader");
const spinNum = document.querySelector(".wrapper-number__games");
const startBtn = document.querySelector(".wrapper-start");
startBtn.classList.add('puls')

// Create the canvas
let number = 3;
let speed2 = 70;
let click = true;
let click2 = true;
var canvas = document.createElement("canvas");
var ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 480;
wrapper.appendChild(canvas);
let counter22 = 0;

// The main game loop
var lastTime;
function main() {
  var now = Date.now();
  var dt = (now - lastTime) / 1000.0;
  if (counter22 == 1) {
    click = false;
    updateEntities2();
    number = 2;
  }
  if (counter22 == 2) {
    click = false;
    updateEntities3();
    number = 1;
  }
  if (counter22 == 3) {
    click = false;
    updateEntities4();
    number = 0;
  }
  update(dt);
  render();
  lastTime = now;
  requestAnimFrame(main);
}
let qwe = 0;
let qweP = 0;
startBtn.addEventListener("click", (e) => {
  e.preventDefault();
  if (click == true && click2 == true) {
    speed2 = 70;
    click = false;
    startBtn.classList.remove('puls')

    counter22++;
  }else{

  }
});
function init() {
  loader.classList.add('hidden')
  terrainPattern = ctx.createPattern(resources.get("img/bg.png"), "no-repeat");
  reset();
  lastTime = Date.now();
  main();
}

resources.load([
  "img/win_effect_sprite.png",
  "img/05eur.png",
  "img/3eur.png",
  "img/40eur.png",
  "img/megawin_sprite.png",
  "img/games_sprite_1.png",
  "img/games_sprite_2.png",
  "img/games_sprite_3.png",
  "img/bg.png",
  "img/frames1.png",
  "img/frames2.png",
  "img/frames3.png",
]);
resources.onReady(init);

// Game state

var megawin = {
  pos: [0, -400],
  sprite: new Sprite("img/megawin_sprite.png", [0, 0], [466, 382], 20, [
    0,
    1,
    2,
    3,
    4,
    5,
    6,
    7,
    8,
    9,
    10,
    11,
    12,
    13,
    14,
    15,
    16,
    17,
    18,
    19,
    20,
    21,
    22,
  ]),
};

var eur05 = {
  pos: [0, -1300],
  sprite: new Sprite("img/05eur.png", [0, 0], [800, 480], 1, [0]),
};
var eur3 = {
  pos: [0, -1300],
  sprite: new Sprite("img/3eur.png", [0, 0], [800, 480], 1, [0]),
};
var eur40 = {
  pos: [0, -1300],
  sprite: new Sprite("img/40eur.png", [0, 0], [800, 480], 1, [0]),
};
var frames1 = {
  pos: [0, -530],
  sprite: new Sprite("img/frames1.png", [0, 0], [800, 480], 1, [0]),
};
var frames2 = {
  pos: [0, -530],
  sprite: new Sprite("img/frames2.png", [0, 0], [800, 480], 1, [0]),
};
var frames3 = {
  pos: [0, -530],
  sprite: new Sprite("img/frames3.png", [0, 0], [800, 480], 1, [0]),
};

var games = {
  pos: [12, -5080],
  sprite: new Sprite("img/games_sprite_2.png", [0, 0], [780, 5550], 0, [0]),
};
var games2 = {
  pos: [12, -5550],
  sprite: new Sprite("img/games_sprite_1.png", [0, 0], [780, 5550], 0, [0]),
};

var games3 = {
  pos: [12, -5550],
  sprite: new Sprite("img/games_sprite_3.png", [0, 0], [780, 5550], 0, [0]),
};
var win = [
  {
    pos: [12, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [171, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [330, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [489, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [648, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
];
var win2 = [
  {
    pos: [12, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [171, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [330, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [489, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [648, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
];
var win3 = [
  {
    pos: [12, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [171, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [330, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [489, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
  {
    pos: [648, -500],
    sprite: new Sprite("img/win_effect_sprite.png", [0, 0], [140, 140], 15, [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20,
      21,
      22,
      23,
      24,
      25,
      26,
      27,
      28,
      29,
      30,
      31,
      31,
      33,
      34,
      35,
      36,
      37,
      38,
      39,
      40,
      41,
      42,
      43,
      44,
      45,
      46,
      47,
      48,
      49,
    ]),
  },
];

var lastFire = Date.now();
var gameTime = 0;
var isGameOver;
var terrainPattern;

var score = 0;
var scoreEl = document.getElementById("score");

// Update game objects
function update(dt) {
  updateEntities(dt);
}

function updateEntities(dt) {
  frames1.sprite.update(dt);
  frames2.sprite.update(dt);
  frames3.sprite.update(dt);
  megawin.sprite.update(dt);
  for (let i = 0; i < win.length; i++) {
    win[i].sprite.update(dt);
    win2[i].sprite.update(dt);
    win3[i].sprite.update(dt);
  }
}

function updateEntities2(dt) {
  speed2 = speed2 - 0.49;
  if (games.pos[1] >= 9) {
    frames1.pos[1] = 160;
    setTimeout(() => {
      for (let i = 0; i < win.length; i++) {
        win[i].pos[1] = 170;
      }
      eur05.pos[1] = 0;
    }, 500);
    click = true;
    startBtn.classList.add('puls')

    prizeText.classList.remove('hidden')
    prizeText.innerHTML = prizeText1;
    spinNum.innerHTML = 2;
  } else if (games.pos[1] > -150) {
    games.pos[1] += 12;
  } else {
    games.pos[1] += speed2;
  }
}
function updateEntities3(dt) {
  for (let i = 0; i < win.length; i++) {
    win[i].pos[1] = -170;
  }
  frames1.pos[1] = -560;
  eur05.pos[1] = -500;

  speed2 = speed2 - 0.46;
  if (games2.pos[1] >= 7 && games2.pos[1] <= 25) {
    setTimeout(() => {
      for (let i = 0; i < win.length; i++) {
        win2[i].pos[1] = 11;
        win3[i].pos[1] = 329;
      }
    }, 500);

    frames2.pos[1] = 0;
    setTimeout(() => {
      eur3.pos[1] = 0;
    }, 1000);
    click = true;
    startBtn.classList.add('puls')

    prizeText.innerHTML = prizeText2;
    spinNum.innerHTML = 1;
  } else if (games2.pos[1] > -350) {
    games2.pos[1] += 14;
  } else {
    games2.pos[1] += speed2;
    games.pos[1] += speed2;
  }
}
function updateEntities4(dt) {
  frames2.pos[1] = -530;

  speed2 = speed2 - 0.46;
  if (games3.pos[1] >= 9) {
    click = true;
   

    setTimeout(() => {
      for (let i = 0; i < win.length; i++) {
        win[i].pos[1] = 11;
        win2[i].pos[1] = 170;
        win3[i].pos[1] = 329;
      }
      eur40.pos[1] = 0;
      megawin.pos[0] = 180;
      megawin.pos[1] = 80;
    }, 700);
    setTimeout(() => {
      $('#exampleModal2').arcticmodal();
      counter22++
    }, 1200);
    frames3.pos[1] = 0;
    prizeText.innerHTML = prizeText3;
    spinNum.innerHTML = 0;
    startBtn.classList.add('opacity')
const link = document.querySelector(".prize__link");
const modalBtn = document.querySelector(".box-modal__btn");
 link.classList.add('puls')
 modalBtn.classList.add('puls')
    link.addEventListener("click", () => {
      window.open("https://greenspin.bet", "_blank");
    });
  } else if (games3.pos[1] > -350) {
    games3.pos[1] += 14;
  } else {
    games3.pos[1] += speed2;
    games2.pos[1] += speed2;
    eur3.pos[1] = -1300;
    for (let i = 0; i < win.length; i++) {
      win2[i].pos[1] = -511;
      win3[i].pos[1] = -329;
    }
  }
}

// Draw everything
function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = terrainPattern;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  // Render the player if the game isn't over
  if (!isGameOver) {
    renderEntity(games);
    renderEntity(games2);
    renderEntity(games3);
    renderEntities(win);
    renderEntities(win2);
    renderEntities(win3);
    renderEntity(frames1);
    renderEntity(frames2);
    renderEntity(frames3);
    renderEntity(eur05);
    renderEntity(eur3);
    renderEntity(eur40);
    renderEntity(megawin);
  }
}

function renderEntities(list) {
  for (var i = 0; i < list.length; i++) {
    renderEntity(list[i]);
  }
}

function renderEntity(entity) {
  ctx.save();
  ctx.translate(entity.pos[0], entity.pos[1]);
  entity.sprite.render(ctx);
  ctx.restore();
}

// Reset game to original state
function reset() {
  isGameOver = false;
}
function windowToCanvas(canvas, x, y) {
  var bbox = canvas.getBoundingClientRect();
  return {
    x: x - bbox.left * (canvas.width / bbox.width),
    y: y - bbox.top * (canvas.height / bbox.height),
  };
}


