jQuery(document).ready(function($){if($('.reel-trigger').length){$('.reel-trigger').each(function(){var pb=$('<img/>',{src:"/wp-content/themes/RubicFuse/play-button.svg",class:"play-button"});pb.attr('style','width: 58px; height: 58px; top: 50%; left: 50%; position:absolute; margin-top: -29px; margin-left: -29px;');$(this).find('.vc_single_image-wrapper').attr('style','position:relative').prepend(pb)})}
$(document).on('click','.reel-trigger',function(e){var trigger=$(this);var maxheight=0;var modal=$('<div/>',{id:'ffx-reel-modal',class:'rdi-video-carousel-popup vc_row vc_row-fluid'});var videos=[];trigger_index=$(this).index('.reel-trigger');videos=$('.reel-video');var video_count=videos.length;var video_counter=0;var prev_button=$('<div/>',{class:'slideshow-prev vc_column_container vc_col-sm-2 vc_hidden-xs'});var prev_span=$('<span/>');var prev_arrow=$('<span/>',{html:'&lt;',class:'slideshow-arrow'});var prev_title_span=$('<span/>',{text:'',class:'prev-slideshow-title'});var slideshow=$('<div/>',{class:'slideshow vc_column_container vc_col-sm-8 vc_col-xs-12'});var next_button=$('<div/>',{class:'slideshow-next vc_column_container vc_col-sm-2 vc_hidden-xs'});var next_span=$('<span/>');var next_arrow=$('<span/>',{html:'&gt;',class:'slideshow-arrow'});var next_title_span=$('<span/>',{text:'',class:'next-slideshow-title'});var cycle_data={slides:'> div.slideshow-slide',prev:'#ffx-reel-modal .slideshow-prev .slideshow-arrow',next:'#ffx-reel-modal .slideshow-next .slideshow-arrow',paused:!0,fx:"fade",startingSlide:trigger_index,swipe:!0,swipeFx:'scrollHorz'};var share_sprite_container=$('<div/>',{class:'share-sprite-container',id:'share-sprite-container'});var share_sprite=$('<div/>',{class:'share-sprite'});var share_text=share_sprite.clone();share_text.addClass('share-text').text('Share');share_sprite_container.append(share_text);$('.rdi-video-carousel-popup .mfp-close').text('X');prev_span.append(prev_arrow);prev_span.append(prev_title_span);prev_button.append(prev_span);modal.append(prev_button);modal.append(slideshow);$('.mfp-close').remove();var close_button_span=$('<span/>',{text:'x',style:'color: #7f8c8d; border:1px solid #7f8c8d; display: inline-block; font-family: Montserrat; line-height: 1.4em; font-size: 1em; width: 1.5em; height: 1.5em;'}).bind('click',function(){$(this).parent().trigger('click')});var close_button=$('<button/>',{title:"Close (Esc)",type:"button",class:"mfp-close",style:"text-align: center; width: 100%; font-size: 2em; opacity:1;"});close_button.append(close_button_span);next_span.append(next_arrow);next_span.append(next_title_span);next_button.append(close_button);next_button.append(next_span);modal.append(next_button);$('body').append(modal);videos.each(function(){var video=$(this);var clone=video.clone();var clone_url=vcp_data.post_url+'#'+video.attr('id');var clone_title=video.find('.wpb_video_heading').text();var clone_image=video.closest('.wpb_wrapper').find('.wpb_single_image img').attr('src');var clone_description=video.closest('.wpb_wrapper').find('p').text();var clone_username=vcp_data.twitter_handle;var clone_message=video.closest('.wpb_wrapper').find('p').text();clone.attr('class','').addClass('slideshow-slide').find('.play-button').remove();$('#ffx-reel-modal .slideshow').append(clone);var wrapper=clone.find('.wpb_wrapper');var share_sprite_clone=share_sprite_container.clone();var share_facebook=share_sprite.clone().attr('data-url',clone_url).attr('data-title',clone_title).attr('data-image',clone_image).attr('data-description',clone_description).attr('data-username',clone_username).attr('data-message',clone_message).addClass('share-facebook st-custom-button').attr('data-network','facebook');var share_twitter=share_sprite.clone().attr('data-url',clone_url).attr('data-title',clone_title).attr('data-image',clone_image).attr('data-description',clone_description).attr('data-username',clone_username).attr('data-message',clone_message).addClass('share-twitter st-custom-button').attr('data-network','twitter');var share_linkedin=share_sprite.clone().attr('data-url',clone_url).attr('data-title',clone_title).attr('data-image',clone_image).attr('data-description',clone_description).attr('data-username',clone_username).attr('data-message',clone_message).addClass('share-linkedin st-custom-button').attr('data-network','linkedin');var share_all=share_sprite.clone().attr('data-url',clone_url).attr('data-title',clone_title).attr('data-image',clone_image).attr('data-description',clone_description).attr('data-username',clone_username).attr('data-message',clone_message).addClass('share-sharethis st-custom-button').attr('data-network','sharethis');share_sprite_clone.append(share_facebook).append(share_twitter).append(share_linkedin).append(share_all);share_sprite_clone.appendTo(wrapper);video_counter++;if(video_counter==video_count){$('#ffx-reel-modal .slideshow-slide').each(function(){maxheight=($(this).height()>maxheight?$(this).height():maxheight)});$('#ffx-reel-modal .slideshow, #ffx-reel-modal .slideshow-slide, #ffx-reel-modal .slideshow-next, #ffx-reel-modal .slideshow-prev').css('height',maxheight);$('#ffx-reel-modal .slideshow').cycle(cycle_data).on('cycle-update-view',function(event,opts){adjustSlideTitles(opts)}).on('cycle-post-initialize',function(event,opts){adjustSlideTitles(opts)}).on('cycle-before',function(event,opts){pauseCurrentPlayer(opts)});trigger.magnificPopup({type:'inline',items:{src:'#ffx-reel-modal'},callbacks:{open:function(){window.__sharethis__.load('custom-share-buttons',{class:'share-sprite-container'})},close:function(){$('#ffx-reel-modal').remove('')}}}).magnificPopup('open')}})});$(document).on('click','#menu-reels-subpage-navigation a',function(e){e.preventDefault();var rel=$(this).attr('rel');var top=$("#"+rel).offset().top;var header_height=$('header .container').height();var scroll_top=(top-header_height)-10;$('html, body').animate({scrollTop:scroll_top},500)});var hashTrigger=window.location.hash.substr(1);if(hashTrigger){setTimeout(function(){if($('#'+hashTrigger).length){if($('#'+hashTrigger).hasClass('wpb_video_widget')){$('#'+hashTrigger).closest('.reel-trigger').trigger('click')}
if($('#'+hashTrigger).hasClass('vc_row')){var top=$('#'+hashTrigger).offset().top;var header_height=$('header .container').height();var scroll_top=(top-header_height)-10;$('html, body').animate({scrollTop:scroll_top},500)}}},1000)}
function pauseCurrentPlayer(opts){var currentslide=parseInt(opts.currSlide);var options={controls:!0};var iframe=$(opts.slides[currentslide]).find('.wpb_video_wrapper').find('iframe');player=new Vimeo.Player(iframe,options);player.pause();player.setCurrentTime(0)}
function adjustSlideTitles(opts){var numslides=parseInt(opts.slideCount)-1;var currentslide=parseInt(opts.currSlide);var nextslide=parseInt((currentslide==numslides)?0:(currentslide+1));var prevslide=parseInt((currentslide==0)?numslides:(currentslide-1));var nextslidetitle=$(opts.slides[nextslide]).find('.wpb_video_heading').text();var prevslidetitle=$(opts.slides[prevslide]).find('.wpb_video_heading').text();$('#ffx-reel-modal .next-slideshow-title').text(nextslidetitle);$('#ffx-reel-modal .prev-slideshow-title').text(prevslidetitle);var options={controls:!0};var iframe=$(opts.slides[currentslide]).find('.wpb_video_wrapper').find('iframe');player=new Vimeo.Player(iframe,options);player.play()}
if($('.reel-video-hovertest').length){$('.reel-video-hovertest').each(function(){var src=$(this).find('iframe').attr('src')+'&title=0&byline=0&portrait=0&sidedock=0&controls=0&muted=true';var iframe=$('<iframe/>',{src:src,frameborder:0,style:'z-index:0; position:absolute; left:0; top:0'});var options={controls:!1,muted:!0};var player=new Vimeo.Player(iframe,options);$(this).find('iframe').replaceWith(iframe);var width=$(this).width();var height=$(this).height();var overlay=$('<div/>',{height:height,width:width,style:'z-index:100;position:relative;background:rgba(0,0,0,0);opacity:0; position:absolute; left:0; top:0; width: '+width+'px;height:'+height+'px;'}).hover(function(){player.play()},function(){player.pause()});$(this).find('.play-button').replaceWith(overlay)})}
if($('.reel-trigger').length){$('.reel-trigger').find('.vc_single_image-img').each(function(){$(this).lazy({effect:'fadeIn',delay:5000,beforeLoad:function(element){console.log('loading image')},afterLoad:function(element){console.log('loaded image')},onError:function(element){console.log('error loading image')},onFinishedAll:function(){console.log('all images loaded')}})})}
$('.reel-video').lazy();if($('.rdi-autoplay').length){$('.rdi-autoplay').each(function(){var options={controls:!0,autoplay:!0};var _iframe=$(this).find('.wpb_video_wrapper').find('iframe');var src=_iframe.attr('src');var iframe=document.querySelector('iframe');var player=new Vimeo.Player(iframe);player=new Vimeo.Player(iframe,options);player.play();player.on('play',function(){player.setVolume(100)})})}
RDI_makecontentvisible();$(window).resize(function(){RDI_makecontentvisible()});function RDI_makecontentvisible(){if($('.RDI_video_masthead').length||($('body').hasClass('single-project')&&$('.videorow').length)){var header=$('header').first();var header_offset=header.offset();var header_top=header_offset.top;var header_height=header.find('.main-h-bottom').outerHeight();var main_content=$('#main-content');var main_offset=main_content.offset();var main_top=main_offset.top;if(header_top<=main_top){main_content.css('margin-top',header_height)}}}})